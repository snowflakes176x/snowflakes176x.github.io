var data_dict = {
    'all': [
        [288, 289, '辽宁', 'left'],
        [202, 247, '江苏', 'right'],
        [201, 243, '北京', 'left'],
        [107, 209, '山东', 'right'],
        [95, 152, '陕西', 'right'],
        [88, 127, '四川', 'right'],
        [70, 122, '重庆', 'right'],
        [93, 89, '广东', 'right'],
        [48, 124, '黑龙江', 'right'],
        [72, 72, '浙江', 'right'],
        [40, 87, '湖南', 'right'],
        [49, 75, '上海', 'right'],
        [52, 66, '河北', 'right'],
        [45, 53, '河南', 'right'],
        [29, 56, '安徽', 'right'],
        [32, 52, '湖北', 'right'],
        [31, 27, '吉林', 'right'],
        [26, 31, '甘肃', 'right'],
        [21, 36, '天津', 'right'],
        [28, 29, '福建', 'right'],
        [30, 17, '山西', 'right'],
        [10, 25, '内蒙古', 'right'],
        [10, 6, '江西', 'right'],
        [8, 2, '贵州', 'right'],
        [2, 8, '广西', 'right'],
        [0, 6, '海南', 'right'],
        [2, 3, '宁夏', 'right'],
        [1, 2, '新疆', 'right'],
        [0, 2, '西藏', 'right'],
        [1, 0, '云南', 'right']
    ],
    'dancing': [
        [52, 37, '辽宁', 'top'],
        [0, 58, '陕西', 'right'],
        [2, 55, '北京', 'right'],
        [4, 43, '重庆', 'right'],
        [1, 40, '四川', 'right'],
        [10, 31, '广东', 'right'],
        [0, 38, '江苏', 'right'],
        [0, 33, '黑龙江', 'right'],
        [2, 31, '山东', 'right'],
        [2, 26, '湖南', 'right'],
        [0, 21, '河北', 'right'],
        [3, 17, '河南', 'right'],
        [1, 12, '安徽', 'right'],
        [0, 11, '上海', 'right'],
        [6, 5, '浙江', 'right'],
        [0, 8, '天津', 'right'],
        [0, 7, '湖北', 'right'],
        [0, 6, '广西', 'right'],
        [0, 5, '内蒙古', 'right'],
        [1, 3, '福建', 'right'],
        [0, 3, '海南', 'right'],
        [2, 0, '江西', 'right'],
        [0, 2, '甘肃', 'right'],
        [0, 2, '吉林', 'right'],
        [1, 0, '新疆', 'right']
    ],
    'minyue': [
        [85, 114, '江苏', 'right'],
        [43, 113, '辽宁', 'right'],
        [37, 97, '山东', 'right'],
        [9, 65, '北京', 'right'],
        [16, 48, '浙江', 'right'],
        [8, 43, '四川', 'right'],
        [12, 35, '重庆', 'right'],
        [11, 35, '陕西', 'right'],
        [13, 27, '黑龙江', 'right'],
        [17, 16, '河北', 'right'],
        [12, 20, '上海', 'right'],
        [5, 20, '湖北', 'right'],
        [9, 14, '湖南', 'right'],
        [1, 18, '广东', 'right'],
        [5, 14, '吉林', 'right'],
        [5, 13, '安徽', 'right'],
        [4, 12, '河南', 'right'],
        [9, 4, '山西', 'right'],
        [1, 10, '天津', 'right'],
        [1, 9, '甘肃', 'right'],
        [3, 5, '福建', 'right'],
        [1, 5, '内蒙古', 'right'],
        [2, 4, '江西', 'right'],
        [0, 2, '贵州', 'right'],
        [1, 1, '宁夏', 'right'],
        [0, 1, '海南', 'right'],
        [0, 1, '西藏', 'right'],
        [0, 1, '新疆', 'right']
    ],
    'guanxianyue': [
        [162, 89, '北京', 'top'],
        [114, 76, '辽宁', 'top'],
        [96, 62, '江苏', 'top'],
        [71, 38, '陕西', 'top'],
        [71, 31, '广东', 'top'],
        [66, 23, '四川', 'top'],
        [45, 41, '山东', 'top'],
        [31, 34, '上海', 'top'],
        [20, 31, '黑龙江', 'top'],
        [32, 15, '河南', 'top'],
        [23, 24, '湖南', 'top'],
        [37, 9, '浙江', 'top'],
        [25, 20, '甘肃', 'top'],
        [35, 10, '重庆', 'top'],
        [29, 13, '河北', 'top'],
        [23, 17, '安徽', 'top'],
        [26, 9, '吉林', 'top'],
        [16, 15, '湖北', 'top'],
        [20, 9, '山西', 'top'],
        [18, 10, '福建', 'top'],
        [14, 10, '天津', 'top'],
        [3, 13, '内蒙古', 'top'],
        [8, 0, '贵州', 'top'],
        [5, 1, '江西', 'top'],
        [2, 2, '广西', 'top'],
        [1, 0, '宁夏', 'top'],
        [1, 0, '云南', 'top'],
        [0, 1, '海南', 'top'],
        [0, 1, '新疆', 'top'],
        [0, 1, '西藏', 'top']
    ],
    'shengyue': [
        [63, 49, '辽宁', 'top'],
        [20, 37, '山东', 'top'],
        [21, 33, '江苏', 'right'],
        [19, 34, '重庆', 'right'],
        [23, 28, '北京', 'right'],
        [7, 27, '黑龙江', 'top'],
        [13, 17, '四川', 'top'],
        [13, 13, '陕西', 'top'],
        [5, 21, '湖南', 'top'],
        [13, 10, '浙江', 'top'],
        [11, 9, '广东', 'top'],
        [1, 14, '河北', 'top'],
        [10, 5, '湖北', 'top'],
        [4, 11, '福建', 'top'],
        [5, 9, '上海', 'right'],
        [0, 14, '安徽', 'top'],
        [6, 4, '河南', 'top'],
        [2, 6, '天津', 'top'],
        [6, 2, '内蒙古', 'top'],
        [0, 4, '山西', 'top'],
        [0, 2, '吉林', 'top'],
        [1, 0, '江西', 'top'],
        [0, 1, '海南', 'top'],
        [0, 1, '宁夏', 'top']
    ],
    'performance': [
        [16, 14, '辽宁', 'top'],
        [8, 6, '黑龙江', 'right'],
        [5, 6, '北京', 'top'],
        [0, 8, '陕西', 'top'],
        [5, 2, '河北', 'top'],
        [4, 2, '天津', 'top'],
        [3, 3, '山东', 'top'],
        [1, 5, '湖北', 'top'],
        [0, 5, '河南', 'top'],
        [0, 4, '四川', 'top'],
        [1, 2, '湖南', 'top'],
        [1, 1, '上海', 'top'],
        [2, 0, '福建', 'top'],
        [1, 0, '山西', 'top'],
        [0, 1, '宁夏', 'top'],
        [0, 1, '江西', 'top']
    ]
};

// var colors = ['#a6cee3', '#1f78b4', '#b2df8a', '#33a02c', '#fb9a99', '#e31a1c', '#fdbf6f', '#ff7f00', '#cab2d6', '#6a3d9a', '#ffff99', '#b15928'];
// var color_idx = -1;
// var color_generator = function () {
//     color_idx = (color_idx + 1) % colors.length;
//     return colors[color_idx];
// };

var colors = {
    '辽宁': '#A5B592',
    '江苏': '#F3A447',
    '北京': '#D092A7',
    '山东': '#E7BC29',
    '陕西': '#9C85C0',
    '四川': '#809EC2',
    '重庆': '#C3CEB6',
    '广东': '#F7C589',
    '黑龙江': '#E0B6C4',
    '浙江': '#EFD06B',
    '湖南': '#B7A7D1',
    '上海': '#496D99',
    '河北': '#5E6E4A',
    '河南': '#DC7F0E',
    '安徽': '#A94969',
    '湖北': '#B89114',
    '吉林': '#684D95',
    '甘肃': '#365172',
    '天津': '#DFE4D8',
    '福建': '#FADAB4',
    '山西': '#EBD1DA',
    '内蒙古': '#F6E5B0',
    '江西': '#CBC0DE',
    '贵州': '#A2B8D2',
    '广西': '#A5B592',
    '海南': '#F3A447',
    '宁夏': '#D092A7',
    '新疆': '#E7BC29',
    '西藏': '#9C85C0',
    '云南': '#809EC2'
};
var color_generator = function(province) {
    return colors[province];
};

var series_generator = function(data, max_size, fixed_num) {
    var series = [];
    var max_value = 0;
    data.forEach(function(d) {
        if (d[0] + d[1] > max_value) {
            max_value = d[0] + d[1];
        }
    });
    var scale_rate = max_size / Math.sqrt(max_value);
    for (var i = 0; i < data.length; i++) {
        var item = {
            name: data[i][2],
            data: [data[i]],
            type: 'scatter',
            symbolSize: function(d) {
                return Math.sqrt(d[0] + d[1]) * scale_rate;
            },
            label: {
                emphasis: {
                    show: true,
                    formatter: function(param) {
                        return param.data[2] + ': ' + (param.data[0] + param.data[1]) + '人';
                    },
                    position: data[i][3],
                    color: '#3f3f3f',
                    fontSize: 14,
                    fontWeight: 'bold'
                }
            },
            itemStyle: {
                normal: {
                    color: color_generator(data[i][2])
                }
            }
        };
        if (i < fixed_num) {
            item.label.normal = {
                show: true,
                formatter: function(param) {
                    return param.data[2] + ': ' + (param.data[0] + param.data[1]) + '人';
                },
                position: data[i][3],
                color: '#3f3f3f',
                fontSize: 14,
                fontWeight: 'bold'
            };
        }
        series.push(item);
    }
    return series;
};

var setChart = function(id, title, data) {
    var element = $('#' + id);
    element.height(element.width());
    var echart = echarts.init(document.getElementById(id));
    $(window).resize(function() {
        element.height(element.width());
        echart.resize();
    });

    var max_x = 0,
        max_y = 0;
    data.forEach(function(d) {
        max_x = d[0] > max_x ? d[0] : max_x;
        max_y = d[1] > max_y ? d[1] : max_y;
    });
    var max_value = Math.ceil(Math.max(max_x, max_y) / 10) * 10;
    var option = {
        title: {
            text: title,
            left: 'center',
            top: 'top',
            textStyle: {
                fontSize: 18,
                fontWeight: 'bold'
            }
        },
        xAxis: {
            type: 'value',
            name: '男',
            max: max_value,
            nameGap: 16,
            nameTextStyle: {
                fontSize: 16
            },
            splitLine: {
                show: false,
                lineStyle: {
                    type: 'dashed'
                }
            },
            axisLabel: {
                formatter: '{value}'
            }
        },
        yAxis: {
            type: 'value',
            name: '女',
            max: max_value,
            nameGap: 16,
            nameTextStyle: {
                fontSize: 16
            },
            splitLine: {
                show: false,
                lineStyle: {
                    type: 'dashed'
                }
            },
            axisLabel: {
                formatter: '{value}'
            }
        },
        series: series_generator(data, 60, 5)
    };
    echart.setOption(option);
};

var setMiniChart = function(id, title, data) {
    var element = $('#' + id);
    element.height(element.width());
    var echart = echarts.init(document.getElementById(id));
    $(window).resize(function() {
        element.height(element.width());
        echart.resize();
    });

    var max_x = 0,
        max_y = 0;
    data.forEach(function(d) {
        max_x = d[0] > max_x ? d[0] : max_x;
        max_y = d[1] > max_y ? d[1] : max_y;
    });
    var max_value = Math.ceil(Math.max(max_x, max_y) / 10) * 10;
    var option = {
        title: {
            text: title,
            left: 'center',
            top: 'top',
            textStyle: {
                fontSize: 18,
                fontWeight: 'bold'
            }
        },
        xAxis: {
            type: 'value',
            name: '男',
            max: max_value,
            nameGap: 12,
            nameTextStyle: {
                fontSize: 12,
                padding: [0, 0, 0, -2]
            },
            splitLine: {
                show: false,
                lineStyle: {
                    type: 'dashed'
                }
            },
            axisLabel: {
                formatter: '{value}'
            }
        },
        yAxis: {
            type: 'value',
            name: '女',
            max: max_value,
            nameGap: 12,
            nameTextStyle: {
                fontSize: 12
            },
            splitLine: {
                show: false,
                lineStyle: {
                    type: 'dashed'
                }
            },
            axisLabel: {
                formatter: '{value}'
            }
        },
        series: series_generator(data, 40, 2)
    };
    echart.setOption(option);
};

var setPieChart = function(id, title) {
    var element = $('#' + id);
    element.height(element.width());
    var echart = echarts.init(document.getElementById(id));
    $(window).resize(function() {
        element.height(element.width());
        echart.resize();
    });

    var option = {
        title: {
            text: title,
            left: 'center',
            top: 'top',
            textStyle: {
                fontSize: 18,
                fontWeight: 'bold'
            }
        },
        series: [{
            name: 'data',
            type: 'pie',
            radius: '75%',
            center: ['50%', '55%'],
            data: [
                { value: 1599, name: '管弦乐类' },
                { value: 1057, name: '民乐类' },
                { value: 594, name: '声乐类' },
                { value: 581, name: '舞蹈类' },
                { value: 107, name: '表演类' }
            ],
            label: {
                normal: {
                    show: true,
                    formatter: '{b}: {d}%',
                    position: 'inner'
                }
            },
            itemStyle: {
                emphasis: {
                    shadowBlur: 10,
                    shadowOffsetX: 0,
                    shadowColor: 'rgba(0, 0, 0, 0.5)'
                }
            },
            color: ['#A5B592', '#F3A447', '#D092A7', '#9C85C0', '#809EC2']
        }]
    };
    echart.setOption(option);
};

$(document).ready(function() {
    $('.echart').each(function() {
        var id = $(this).attr('id');
        var title = '2017年' + $(this).attr('title') + '特长生分布';
        var data = data_dict[id.split('-')[1]];
        setChart(id, title, data);
    });

    $('.mini-echart').each(function() {
        var id = $(this).attr('id');
        var title = '2017年' + $(this).attr('title') + '特长生分布';
        var data = data_dict[id.split('-')[1]];
        setMiniChart(id, title, data);
    });

    $('.pie-echart').each(function() {
        var id = $(this).attr('id');
        var title = '2017年各省毕业艺术特长生项目比重';
        setPieChart(id, title);
    });
});